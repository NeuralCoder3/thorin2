// RUN: rm -f %t.ll ; \
// RUN: %thorin -d autodiff %s --output-ll %t.ll --output-thorin - | FileCheck %s

// a call to a autodiff style function


// ./build/bin/thorin -d autodiff ./lit/autodiff/pow_autodiff_eval.thorin --output-thorin - -VVVV -d direct -d tool -d autodiff
// ./build/bin/thorin -d autodiff ./lit/autodiff/pow_autodiff_eval.thorin --output-thorin - -VVVV -d direct -d tool -d autodiff -d mem

.import autodiff;
.import core;
.import direct;
.import mem;
.import tool;
// .lam .extern internal_diff_core_icmp_xyglE __797790: .Nat → .Cn [«2; (%Int __797790)», .Cn [(%Int 2), .Cn [(%Int 2), .Cn «2; (%Int __797790)»]]] = {
//     .cn cmp_pb_797892 __797903::[(%Int 2), pb_ret_797905: .Cn «2; (%Int __797790)»] = {
//         pb_ret_797905 ‹2; 0:(%Int __797790)›
//     };
//     .cn inner_cmp_797835 __797848::[__797867::[_797871: (%Int __797790), _797875: (%Int __797790)], ret_797850: .Cn [(%Int 2), .Cn [(%Int 2), .Cn «2; (%Int __797790)»]]] = {
//         .let _797878: (%Int 2) = %core.icmp.xYgLE __797790 __797867;
//         ret_797850 (_797878, cmp_pb_797892)
//     };
//     1:(%Int 2), _797921
// };
// .lam .extern internal_diff_core_wrap_add __798013::[_798102: .Nat, w_798014: .Nat] → .Cn [«2; (%Int w_797946)», .Cn [(%Int w_797946), .Cn [(%Int w_797946), .Cn «2; (%Int w_797946)»]]] = {
//     .cn add_pb_798114 __798122::[s_798132: (%Int w_798014), pb_ret_798124: .Cn «2; (%Int w_798014)»] = {
//         pb_ret_798124 ‹2; s_798132›
//     };
//     .cn inner_add_deriv_cps_798061 __798070::[__798090::[_798094: (%Int w_798014), _798098: (%Int w_798014)], ret_798072: .Cn [(%Int w_798014), .Cn [(%Int w_798014), .Cn «2; (%Int w_798014)»]]] = {
//         .let _798105: (%Int w_798014) = %core.wrap.add __798013 __798090;
//         ret_798072 (_798105, add_pb_798114)
//     };
//     1:(%Int 2), _798137
// };
// .lam .extern internal_diff_core_wrap_mul __798223::[_798306: .Nat, w_798224: .Nat] → .Cn [«2; (%Int w_798162)», .Cn [(%Int w_798162), .Cn [(%Int w_798162), .Cn «2; (%Int w_798162)»]]] = {
//     .cn inner_mul_deriv_cps_798265 __798274::[__798294::[_798298: (%Int w_798224), _798302: (%Int w_798224)], ret_798276: .Cn [(%Int w_798224), .Cn [(%Int w_798224), .Cn «2; (%Int w_798224)»]]] = {
//         .cn mul_pb_798319 __798328::[s_798343: (%Int w_798224), pb_ret_798330: .Cn «2; (%Int w_798224)»] = {
//             .let _798355: (%Int w_798224) = %core.wrap.mul __798223 (__798294#1:(%Int 2), s_798343);
//             .let _798365: (%Int w_798224) = %core.wrap.mul __798223 (__798294#0:(%Int 2), s_798343);
//             pb_ret_798330 (_798355, _798365)
//         };
//         .let _798309: (%Int w_798224) = %core.wrap.mul __798223 __798294;
//         ret_798276 (_798309, mul_pb_798319)
//     };
//     1:(%Int 2), _798369
// };
.cn zero_pb_798560 _798561::[(%Int 4294967296), _798563: .Cn «2; (%Int 4294967296)»] = {
    _798563 (%autodiff.zero «2; (%Int 4294967296)»)
};
.lam Uf_798586 _798604: «2; (%Int 4294967296)» → ★ = {
    [(%Int 4294967296), .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]]
};
.lam Uf_798682 _798700: «2; (%Int 4294967296)» → ★ = {
    [(%Int 4294967296), .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]]
};
.lam Uf_798819 _798837: (%Int 4294967296) → ★ = {
    «2; (%Int 4294967296)»
};
.cn id_pb_798870 _798871::[s_798875: «2; (%Int 4294967296)», _798873: .Cn «2; (%Int 4294967296)»] = {
    _798873 s_798875
};
.cn extract_pb_798867 _798879::[s_798881: (%Int 4294967296), _798884: .Cn «2; (%Int 4294967296)»] = {
    id_pb_798870 (.insert (%autodiff.zero «2; (%Int 4294967296)», 0:(%Int 2), s_798881), _798884)
};
.lam Uf_798898 _798916: (%Int 4294967296) → ★ = {
    «2; (%Int 4294967296)»
};
.lam Uf_799007 _799025: (%Int 4294967296) → ★ = {
    «2; (%Int 4294967296)»
};
.lam Uf_799064 _799082: (%Int 4294967296) → ★ = {
    «2; (%Int 4294967296)»
};
.lam Uf_799126 _799144: (%Int 4294967296) → ★ = {
    «2; (%Int 4294967296)»
};
.cn zero_pb_799172 _799173::[(%Int 4294967296), _799175: .Cn «2; (%Int 4294967296)»] = {
    _799175 (%autodiff.zero «2; (%Int 4294967296)»)
};
.lam Uf_799188 _799206: (%Int 4294967296) → ★ = {
    «2; (%Int 4294967296)»
};
.cn extract_pb_799234 _799235::[s_799237: (%Int 4294967296), _799240: .Cn «2; (%Int 4294967296)»] = {
    id_pb_798870 (.insert (%autodiff.zero «2; (%Int 4294967296)», 1:(%Int 2), s_799237), _799240)
};
.cn tup_pb_799117 _799118::[tup_s_799179::[_799180: (%Int 4294967296), _799244: (%Int 4294967296)], _799120: .Cn «2; (%Int 4294967296)»] = {
    .let _799181: «2; (%Int 4294967296)» = %direct.cps2ds_dep ((%Int 4294967296), Uf_799126) zero_pb_799172 tup_s_799179#0:(%Int 2);
    .let _799245: «2; (%Int 4294967296)» = %direct.cps2ds_dep ((%Int 4294967296), Uf_799188) extract_pb_799234 tup_s_799179#1:(%Int 2);
    .let _799265: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_799181#0:(%Int 2), _799245#0:(%Int 2));
    .let _799275: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_799181#1:(%Int 2), _799245#1:(%Int 2));
    _799120 (_799265, _799275)
};
.lam Uf_799350 _799368: «2; (%Int 4294967296)» → ★ = {
    [(%Int 2), .Cn [(%Int 2), .Cn «2; (%Int 4294967296)»]]
};
.cn tup_pb_799427 _799428::[[], _799430: .Cn «2; (%Int 4294967296)»] = {
    _799430 (%autodiff.zero «2; (%Int 4294967296)»)
};
.cn f_deriv_798526 _798547::[arg_798574::[_798575: (%Int 4294967296), _798663: (%Int 4294967296)], _798549: .Cn [(%Int 4294967296), .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]]] = {
    .cn aug_pow_then_798546 [[], .Cn [[], .Cn «2; (%Int 4294967296)»]] = {
        _798549 (1:(%Int 4294967296), zero_pb_798560)
    };
    .cn aug_pow_cont_798681 _798753::[_798755: (%Int 4294967296), _798945: .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]] = {
        .cn tup_pb_798784 _798785::[tup_s_798889::[_798890: (%Int 4294967296), _798947: (%Int 4294967296)], _798787: .Cn «2; (%Int 4294967296)»] = {
            .let _798891: «2; (%Int 4294967296)» = %direct.cps2ds_dep ((%Int 4294967296), Uf_798819) extract_pb_798867 tup_s_798889#0:(%Int 2);
            .let _798948: «2; (%Int 4294967296)» = %direct.cps2ds_dep ((%Int 4294967296), Uf_798898) _798945 tup_s_798889#1:(%Int 2);
            .let _798964: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_798891#0:(%Int 2), _798948#0:(%Int 2));
            .let _798974: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_798891#1:(%Int 2), _798948#1:(%Int 2));
            _798787 (_798964, _798974)
        };
            .let _798757: [(%Int 4294967296), .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]] = %direct.cps2ds_dep («2; (%Int 4294967296)», Uf_798682) (internal_diff_core_wrap_mul (0, 4294967296)) (arg_798574#0:(%Int 2), _798755);
        .cn comp_tup_pb__798762 _798765::[_798767: (%Int 4294967296), _798981: .Cn «2; (%Int 4294967296)»] = {
            .cn comp_tup_pb__cont_798776 _798979: «2; (%Int 4294967296)» = {
                tup_pb_798784 (_798979, _798981)
            };
            _798757#1:(%Int 2) (_798767, comp_tup_pb__cont_798776)
        };
        _798549 (_798757#0:(%Int 2), comp_tup_pb__798762)
    };
        .let _798665: [(%Int 4294967296), .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]] = %direct.cps2ds_dep («2; (%Int 4294967296)», Uf_798586) (internal_diff_core_wrap_add (0, 4294967296)) (4294967295:(%Int 4294967296), arg_798574#1:(%Int 2));
    .cn comp_tup_pb__799110 _799113::[_799115: (%Int 4294967296), _799282: .Cn «2; (%Int 4294967296)»] = {
        .cn comp_tup_pb__cont_799116 _799280: «2; (%Int 4294967296)» = {
            tup_pb_799117 (_799280, _799282)
        };
        _798665#1:(%Int 2) (_799115, comp_tup_pb__cont_799116)
    };
    .cn tup_pb_798998 _798999::[tup_s_799055::[_799056: (%Int 4294967296), _799288: (%Int 4294967296)], _799001: .Cn «2; (%Int 4294967296)»] = {
        .let _799057: «2; (%Int 4294967296)» = %direct.cps2ds_dep ((%Int 4294967296), Uf_799007) extract_pb_798867 tup_s_799055#0:(%Int 2);
        .let _799289: «2; (%Int 4294967296)» = %direct.cps2ds_dep ((%Int 4294967296), Uf_799064) comp_tup_pb__799110 tup_s_799055#1:(%Int 2);
        .let _799308: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_799057#0:(%Int 2), _799289#0:(%Int 2));
        .let _799318: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_799057#1:(%Int 2), _799289#1:(%Int 2));
        _799001 (_799308, _799318)
    };
    .cn c1_798678 _798988::[_798990: (%Int 4294967296), _798993: .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]] = {
        .cn comp_tup_pb__798991 _798994::[_798996: (%Int 4294967296), _799325: .Cn «2; (%Int 4294967296)»] = {
            .cn comp_tup_pb__cont_798997 _799323: «2; (%Int 4294967296)» = {
                tup_pb_798998 (_799323, _799325)
            };
            _798993 (_798996, comp_tup_pb__cont_798997)
        };
        aug_pow_cont_798681 (_798990, comp_tup_pb__798991)
    };
    .cn aug_pow_else_798570 [[], .Cn [[], .Cn «2; (%Int 4294967296)»]] = {
        f_deriv_798526 ((arg_798574#0:(%Int 2), _798665#0:(%Int 2)), c1_798678)
    };
    .let _799423: [(%Int 2), .Cn [(%Int 2), .Cn «2; (%Int 4294967296)»]] = %direct.cps2ds_dep («2; (%Int 4294967296)», Uf_799350) (internal_diff_core_icmp_xyglE 4294967296) (0:(%Int 4294967296), arg_798574#1:(%Int 2));
    (aug_pow_then_798546, aug_pow_else_798570)#(_799423#0:(%Int 2)) ((), tup_pb_799427)
};
.cn .extern main __799501::[mem_799522: %mem.M, (%Int 4294967296), %mem.Ptr (%mem.Ptr ((%Int 256), 0), 0), return_799505: .Cn [%mem.M, (%Int 4294967296)]] = {
    .cn ret_cont_799462 __799472::[r_799554: (%Int 4294967296), pb_799474: .Cn [(%Int 4294967296), .Cn «2; (%Int 4294967296)»]] = {
        .cn pb_ret_cont_799491 __799575::[pr_a_799594: (%Int 4294967296), pr_b_799576: (%Int 4294967296)] = {
            .let _799565: (%Int 4294967296) = %core.wrap.mul (0, 4294967296) (10000:(%Int 4294967296), r_799554);
            .let _799605: (%Int 4294967296) = %core.wrap.mul (0, 4294967296) (100:(%Int 4294967296), pr_a_799594);
            .let _799610: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (pr_b_799576, _799605);
            .let _799615: (%Int 4294967296) = %core.wrap.add (0, 4294967296) (_799565, _799610);
            return_799505 (mem_799522, _799615)
        };
        pb_799474 (1:(%Int 4294967296), pb_ret_cont_799491)
    };
    f_deriv_798526 ((4:(%Int 4294967296), 3:(%Int 4294967296)), ret_cont_799462)
};